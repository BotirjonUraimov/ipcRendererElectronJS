<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline';"
    />
    <title>Your Electron App</title>
    <style>
      #container {
        display: flex;
        flex-direction: column;
        height: auto;
      }
      #rgb-container img,
      #depth-container img {
        width: 100%;
        height: auto;
      }
    </style>
  </head>
  <body style="display: flex; flex-direction: column">
    <h2>RealSense Frames Display</h2>
    <button id="start-server">Start Server</button>
    <button id="stop-server">Stop Server</button>
    <div id="container">
      <div id="rgb-container">
        <img id="rgb-image" src="" alt="RGB Frame" />
      </div>
    </div>
    <button id="equilibrium">equilibrium</button>
    <button id="flexibility">flexibility</button>
    <button id="restart">restart</button>

    <button id="reaction_first_round">reaction_first_round</button>

    <button id="reaction_second_round">reaction_second_round</button>
    <button id="reaction_third_round">reaction_third_round</button>
    <button id="jumping_first_round">jumping_first_round</button>
    <button id="jumping_second_round">jumping_second_round</button>

    <script>
      const { ipcRenderer } = require("electron");
      const fs = require("fs");

      function saveImage(dataUrl, filename) {
        // Convert base64 to raw binary data held in a string
        const base64Data = dataUrl.replace(/^data:image\/jpeg;base64,/, "");

        // Write the file to disk
        fs.writeFile(filename, base64Data, "base64", (err) => {
          if (err) alert("Error saving the image: " + err.message);
          else alert("Image saved successfully!");
        });
      }

      let frame_data = "";
      ipcRenderer.on("frame-data", (event, frameData) => {
        console.log("frameData", frameData);
        frame_data = frameData;
        if (frameData.rgb) {
          const rgbImage = document.getElementById("rgb-image");
          rgbImage.src = `data:image/jpeg;base64,${frameData.rgb}`;
        }
        if (frameData.depth) {
          const depthImage = document.getElementById("depth-image");
          depthImage.src = `data:image/jpeg;base64,${frameData.depth}`;
        }
      });

      // button for front
      document.getElementById("equilibrium").addEventListener("click", () => {
        ipcRenderer.send("save-command", "equilibrium");
      });

      // button for back
      document.getElementById("flexibility").addEventListener("click", () => {
        ipcRenderer.send("save-command", "flexibility");
      });

      document.getElementById("restart").addEventListener("click", () => {
        ipcRenderer.send("save-command", "restart");
      });

      // button for side
      document
        .getElementById("reaction_first_round")
        .addEventListener("click", () => {
          ipcRenderer.send("save-command", "reaction_first_round");
        });

      // button for rom by foot
      document
        .getElementById("reaction_second_round")
        .addEventListener("click", () => {
          ipcRenderer.send("save-command", "reaction_second_round");
        });

      document
        .getElementById("reaction_third_round")
        .addEventListener("click", () => {
          ipcRenderer.send("save-command", "reaction_third_round");
        });

      document
        .getElementById("jumping_first_round")
        .addEventListener("click", () => {
          ipcRenderer.send("save-command", "jumping_first_round");
        });

      document
        .getElementById("jumping_second_round")
        .addEventListener("click", () => {
          ipcRenderer.send("save-command", "jumping_second_round");
        });

      //running socket server
      document.getElementById("start-server").addEventListener("click", () => {
        //ipcRenderer.send('start-server');
        ipcRenderer.send("save-command", "start");
      });

      //stop socket server
      document.getElementById("stop-server").addEventListener("click", () => {
        //ipcRenderer.send('stop-server');
        ipcRenderer.send("save-command", "stop");
      });

      ipcRenderer.on("server-status", (event, status) => {
        console.log("Server status:", status);
        // for Update UI based on server status
      });
    </script>
  </body>
</html>
