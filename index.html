<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline';"
    />
    <title>Your Electron App</title>
    <style>
      #container {
        display: flex;
        flex-direction: column;
        height: auto;
      }
      #rgb-container img,
      #depth-container img {
        width: 100%;
        height: auto;
      }
    </style>
  </head>
  <body style="display: flex; flex-direction: column">
    <h2>RealSense Frames Display</h2>
    <button id="start-server">Start Server</button>
    <button id="stop-server">Stop Server</button>
    <div id="container">
      <div id="rgb-container">
        <img id="rgb-image" src="" alt="RGB Frame" />
      </div>
      <div id="depth-container">
        <img id="depth-image" src="" alt="Depth Frame" />
      </div>
    </div>

    <button id="front">reaction 1</button>

    <button id="back">For reaction 2</button>
    <button id="side">For reaction 3</button>

    <button id="rom_ha_left">flexibility</button>
    <button id="rom_ha_right">equilibrium_first_round</button>
    <button id="rom_hf_left">equilibrium_second_round</button>
    <button id="rom_hf_right">jumping_first_round</button>

    <button id="rom_sa_left">jumping_second_round</button>
    <button id="rom_sa_right">rom_sa_right</button>
    <button id="rom_sf_left">rom_sf_left</button>
    <button id="rom_sf_right">rom_sf_right</button>

    <script>
      const { ipcRenderer } = require("electron");
      const fs = require("fs");

      function saveImage(dataUrl, filename) {
        // Convert base64 to raw binary data held in a string
        const base64Data = dataUrl.replace(/^data:image\/jpeg;base64,/, "");

        // Write the file to disk
        fs.writeFile(filename, base64Data, "base64", (err) => {
          if (err) alert("Error saving the image: " + err.message);
          else alert("Image saved successfully!");
        });
      }

      ipcRenderer.on("frame-data", (event, frameData) => {
        console.log("frameData", frameData);
        if (frameData.rgb) {
          const rgbImage = document.getElementById("rgb-image");
          rgbImage.src = `data:image/jpeg;base64,${frameData.rgb}`;
        }
        if (frameData.depth) {
          const depthImage = document.getElementById("depth-image");
          depthImage.src = `data:image/jpeg;base64,${frameData.depth}`;
        }
      });

      // button for front
      document.getElementById("front").addEventListener("click", () => {
        ipcRenderer.send("save-command", "reaction_first_round");
      });

      // button for back
      document.getElementById("back").addEventListener("click", () => {
        ipcRenderer.send("save-command", "reaction_second_round");
      });

      // button for side
      document.getElementById("side").addEventListener("click", () => {
        ipcRenderer.send("save-command", "reaction_third_round");
      });

      // button for rom by foot
      document.getElementById("rom_ha_left").addEventListener("click", () => {
        ipcRenderer.send("save-command", "flexibility");
      });

      document.getElementById("rom_ha_right").addEventListener("click", () => {
        ipcRenderer.send("save-command", "equilibrium_first_round");
      });

      document.getElementById("rom_hf_left").addEventListener("click", () => {
        ipcRenderer.send("save-command", "equilibrium_second_round");
      });

      document.getElementById("rom_hf_right").addEventListener("click", () => {
        ipcRenderer.send("save-command", "jumping_first_round");
      });

      // button for rom by hand
      document.getElementById("rom_sa_left").addEventListener("click", () => {
        ipcRenderer.send("save-command", "jumping_second_round");
      });

      document.getElementById("rom_sa_right").addEventListener("click", () => {
        ipcRenderer.send("save-command", "rom_sa_right");
        alert("Image saved successfully!");
      });

      document.getElementById("rom_sf_left").addEventListener("click", () => {
        ipcRenderer.send("save-command", "rom_sf_left");
        alert("Image saved successfully!");
      });

      document.getElementById("rom_sf_right").addEventListener("click", () => {
        ipcRenderer.send("save-command", "rom_sf_right");

        alert("Image saved successfully!");
      });

      //running socket server
      document.getElementById("start-server").addEventListener("click", () => {
        //ipcRenderer.send('start-server');
        ipcRenderer.send("save-command", "start");
      });

      //stop socket server
      document.getElementById("stop-server").addEventListener("click", () => {
        //ipcRenderer.send('stop-server');
        ipcRenderer.send("save-command", "stop");
      });

      ipcRenderer.on("server-status", (event, status) => {
        console.log("Server status:", status);
        // for Update UI based on server status
      });
    </script>
  </body>
</html>
